name: "Upgrade code to use Managed Identity in Azure SQL (Public Cloud)"
description: "Migrate Azure SQL authentication to managed identity using ActiveDirectoryMSI"
codeLocation:
  type: "textsearch"
  codePattern: "SQLServerDataSource"
  filePattern: "**/*.java"
steps:
  - description: "
Migrate to Managed Identity authentication"
    type: "instruction"
    content: |
      Your task is to migrate a java file from using a connection string to using passwordless managed identity for authentication in Azure SQL (Public Cloud).
      Ensure the resulting code is clean, efficient, and preserves the original functionality.
      Please ensure to follow the guidance below to complete this task:
      1. Remove user and password usage: Eliminate the hardcoded user and password in the connection string.
      2. Please add a variable for the Azure client ID of managed identity.
      3. Please append msiClientId to the connection string url: ";msiClientId=" + <azure managed identity client id>
      4. Please append this exact string of authentication to the connection string url: ";authentication=ActiveDirectoryMSI"
      5. Use the updated connection string url for SQLServerDataSource when set url.

      Below are the APIs provided for your reference:

      Class: SQLServerDataSource
        Description: Represents a list of properties specific to connecting to a SQL Server database by using a SQLServerConnection object.
        Package: com.microsoft.sqlserver.jdbc
        Implements: ISQLServerDataSource, DataSource, java.io.Serializable, javax.naming.Referenceable
        Contructor:
          SQLServerDataSource(): Initializes a new instance of the SQLServerDataSource class.
        Methods:
          setUrl(String url): Sets the URL that is used to connect to the data source.
          getURL(): Returns the URL used to connect to the data source.
          getConnection(): 	Tries to establish a connection with the data source that this SQLServerDataSource object represents.
