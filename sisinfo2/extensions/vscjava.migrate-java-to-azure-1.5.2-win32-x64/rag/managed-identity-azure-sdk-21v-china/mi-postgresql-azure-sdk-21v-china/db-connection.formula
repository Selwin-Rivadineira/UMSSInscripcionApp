name: "Upgrade code to use Managed Identity in Azure PostgreSQL (China Cloud)"
description: "Migrate Azure PostgreSQL auth to managed identity approach using AzurePostgresqlAuthenticationPlugin."
codeLocation:
  type: "textsearch"
  codePattern: "DriverManager"
  filePattern: "**/*.java"
steps:
  - description: "Migrate to Managed Identity authentication"
    type: "instruction"
    content: |
      Your task is to migrate a java file from using a connection string to using passwordless managed identity for authentication in Azure PostgreSQL (China Cloud).
      Ensure the resulting code is clean, efficient, and preserves the original functionality.
      Please ensure to follow the guidance below to complete this task:
      1. Remove password Usage: Eliminate the hardcoded password in the connection string.
      2. Replace the value of user name with managed identity for the database connection: Please use the name of managed identity to replace the value of the user name for PostgreSQL database connection.
      3. Add Authentication Plugin Config: Please add a new string variable for authenticationPluginClassNameConfig. The value should be exactly this string "&authenticationPluginClassName=com.azure.identity.extensions.jdbc.postgresql.AzurePostgresqlAuthenticationPlugin".
      4. Append the mentioned authenticationPluginClassNameConfig to the connection string url.
      5. Use the updated connection string url to get Connection.

      Below are the APIs provided for your reference:

      Class: DriverManager
        Description: The basic service for managing a set of JDBC drivers.
        Package: java.sql
        Methods:
          getConnection(String url): Attempts to establish a connection to the given database URL.
          getConnection(String url, Properties info): Attempts to establish a connection to the given database URL.
