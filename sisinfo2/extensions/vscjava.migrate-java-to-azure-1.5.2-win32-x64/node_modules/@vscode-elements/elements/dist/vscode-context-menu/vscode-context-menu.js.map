{"version":3,"file":"vscode-context-menu.js","sourceRoot":"","sources":["../../src/vscode-context-menu/vscode-context-menu.ts"],"names":[],"mappings":"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","sourcesContent":["import {html, nothing, TemplateResult} from 'lit';\nimport {property, query, state} from 'lit/decorators.js';\nimport {customElement, VscElement} from '../includes/VscElement.js';\nimport type {\n  VscClickEventDetail,\n  VscodeContextMenuItem,\n} from '../vscode-context-menu-item/vscode-context-menu-item.js';\nimport '../vscode-context-menu-item/index.js';\nimport styles from './vscode-context-menu.styles.js';\n\ninterface MenuItemData {\n  label?: string;\n  keybinding?: string;\n  value?: string;\n  separator?: boolean;\n  tabindex?: number;\n}\n\nexport type VscContextMenuSelectEvent = CustomEvent<{\n  keybinding: string;\n  label: string;\n  value: string;\n  separator: boolean;\n  tabindex: number;\n}>;\n\n/**\n * @tag vscode-context-menu\n *\n * @fires {VscMenuSelectEvent} vsc-menu-select - Emitted when a menu item is clicked\n *\n * @cssprop [--vscode-font-family=sans-serif]\n * @cssprop [--vscode-font-size=13px]\n * @cssprop [--vscode-font-weight=normal]\n * @cssprop [--vscode-menu-background=#1f1f1f]\n * @cssprop [--vscode-menu-border=#454545]\n * @cssprop [--vscode-menu-foreground=#cccccc]\n * @cssprop [--vscode-widget-shadow=rgba(0, 0, 0, 0.36)]\n */\n@customElement('vscode-context-menu')\nexport class VscodeContextMenu extends VscElement {\n  static override styles = styles;\n\n  @property({type: Array, attribute: false})\n  set data(data: MenuItemData[]) {\n    this._data = data;\n\n    const indexes: number[] = [];\n\n    data.forEach((v, i) => {\n      if (!v.separator) {\n        indexes.push(i);\n      }\n    });\n\n    this._clickableItemIndexes = indexes;\n  }\n  get data(): MenuItemData[] {\n    return this._data;\n  }\n\n  /**\n   * By default, the menu closes when an item is clicked. This attribute prevents the menu from closing.\n   */\n  @property({type: Boolean, reflect: true, attribute: 'prevent-close'})\n  preventClose = false;\n\n  @property({type: Boolean, reflect: true})\n  set show(show: boolean) {\n    this._show = show;\n    this._selectedClickableItemIndex = -1;\n\n    if (show) {\n      this.updateComplete.then(() => {\n        if (this._wrapperEl) {\n          this._wrapperEl.focus();\n        }\n\n        requestAnimationFrame(() => {\n          document.addEventListener('click', this._onClickOutsideBound, {\n            once: true,\n          });\n        });\n      });\n    }\n  }\n  get show(): boolean {\n    return this._show;\n  }\n\n  /** @internal */\n  @property({type: Number, reflect: true})\n  override tabIndex = 0;\n\n  constructor() {\n    super();\n    this.addEventListener('keydown', this._onKeyDown);\n  }\n\n  /* connectedCallback(): void {\n    super.connectedCallback();\n    document.addEventListener('click', this._onClickOutsideBound);\n  }\n\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    document.removeEventListener('click', this._onClickOutsideBound);\n  } */\n\n  @state()\n  private _selectedClickableItemIndex = -1;\n\n  @state()\n  private _show = false;\n\n  @query('.context-menu')\n  private _wrapperEl!: HTMLDivElement;\n\n  private _data: MenuItemData[] = [];\n\n  private _clickableItemIndexes: number[] = [];\n\n  private _onClickOutside(ev: MouseEvent) {\n    if (!ev.composedPath().includes(this)) {\n      this.show = false;\n    }\n  }\n\n  private _onClickOutsideBound = this._onClickOutside.bind(this);\n\n  private _onKeyDown(ev: KeyboardEvent) {\n    const {key} = ev;\n\n    if (\n      key === 'ArrowUp' ||\n      key === 'ArrowDown' ||\n      key === 'Escape' ||\n      key === 'Enter'\n    ) {\n      ev.preventDefault();\n    }\n\n    switch (key) {\n      case 'ArrowUp':\n        this._handleArrowUp();\n        break;\n      case 'ArrowDown':\n        this._handleArrowDown();\n        break;\n      case 'Escape':\n        this._handleEscape();\n        break;\n      case 'Enter':\n        this._handleEnter();\n        break;\n      default:\n    }\n  }\n\n  private _handleArrowUp() {\n    if (this._selectedClickableItemIndex === 0) {\n      this._selectedClickableItemIndex = this._clickableItemIndexes.length - 1;\n    } else {\n      this._selectedClickableItemIndex -= 1;\n    }\n  }\n\n  private _handleArrowDown() {\n    if (\n      this._selectedClickableItemIndex + 1 <\n      this._clickableItemIndexes.length\n    ) {\n      this._selectedClickableItemIndex += 1;\n    } else {\n      this._selectedClickableItemIndex = 0;\n    }\n  }\n\n  private _handleEscape() {\n    this.show = false;\n    document.removeEventListener('click', this._onClickOutsideBound);\n  }\n\n  private _dispatchSelectEvent(selectedOption: VscodeContextMenuItem) {\n    const {keybinding, label, value, separator, tabindex} = selectedOption;\n\n    this.dispatchEvent(\n      new CustomEvent('vsc-context-menu-select', {\n        detail: {\n          keybinding,\n          label,\n          separator,\n          tabindex,\n          value,\n        },\n      }) as VscContextMenuSelectEvent\n    );\n  }\n\n  private _dispatchLegacySelectEvent(selectedOption: VscodeContextMenuItem) {\n    const {keybinding, label, value, separator, tabindex} = selectedOption;\n    const detail: VscClickEventDetail = {\n      keybinding,\n      label,\n      value,\n      separator,\n      tabindex,\n    };\n\n    /** @deprecated - Renamed to `vsc-context-menu-select` */\n    this.dispatchEvent(\n      new CustomEvent('vsc-select', {\n        detail,\n        bubbles: true,\n        composed: true,\n      })\n    );\n  }\n\n  private _handleEnter() {\n    if (this._selectedClickableItemIndex === -1) {\n      return;\n    }\n\n    const realItemIndex =\n      this._clickableItemIndexes[this._selectedClickableItemIndex];\n    const options = this._wrapperEl.querySelectorAll(\n      'vscode-context-menu-item'\n    );\n    const selectedOption = options[realItemIndex];\n\n    this._dispatchLegacySelectEvent(selectedOption);\n    this._dispatchSelectEvent(selectedOption);\n\n    if (!this.preventClose) {\n      this.show = false;\n      document.removeEventListener('click', this._onClickOutsideBound);\n    }\n  }\n\n  private _onItemClick(event: CustomEvent) {\n    const et = event.currentTarget as VscodeContextMenuItem;\n\n    this._dispatchLegacySelectEvent(et);\n    this._dispatchSelectEvent(et);\n\n    if (!this.preventClose) {\n      this.show = false;\n    }\n  }\n\n  private _onItemMouseOver(event: MouseEvent) {\n    const el = event.target as HTMLElement;\n    const index = el.dataset.index ? +el.dataset.index : -1;\n    const found = this._clickableItemIndexes.findIndex(\n      (item) => item === index\n    );\n\n    if (found !== -1) {\n      this._selectedClickableItemIndex = found;\n    }\n  }\n\n  private _onItemMouseOut() {\n    this._selectedClickableItemIndex = -1;\n  }\n\n  override render(): TemplateResult {\n    if (!this._show) {\n      return html`${nothing}`;\n    }\n\n    const selectedIndex =\n      this._clickableItemIndexes[this._selectedClickableItemIndex];\n\n    return html`\n      <div class=\"context-menu\" tabindex=\"0\">\n        ${this.data\n          ? this.data.map(\n              (\n                {\n                  label = '',\n                  keybinding = '',\n                  value = '',\n                  separator = false,\n                  tabindex = 0,\n                },\n                index\n              ) => html`\n                <vscode-context-menu-item\n                  label=${label}\n                  keybinding=${keybinding}\n                  value=${value}\n                  ?separator=${separator}\n                  ?selected=${index === selectedIndex}\n                  tabindex=${tabindex}\n                  @vsc-click=${this._onItemClick}\n                  @mouseover=${this._onItemMouseOver}\n                  @mouseout=${this._onItemMouseOut}\n                  data-index=${index}\n                ></vscode-context-menu-item>\n              `\n            )\n          : html`<slot></slot>`}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'vscode-context-menu': VscodeContextMenu;\n  }\n\n  interface GlobalEventHandlersEventMap {\n    'vsc-context-menu-select': VscContextMenuSelectEvent;\n  }\n}\n"]}